$(function(){function t(t){m=t,d=m,h("ck_cookie",!0),u("ck_cookie")||alert("Cookieが無効になっています。"),u("st_key")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){s()},function(t){e()}):Cookies.get("setting")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){p()},function(t){e()}):e()}function e(){$('#summon_setting div[class^="type"]').each(function(){var t=$(this).attr("class");a(t),n(t),c(t),r()})}function a(t){var t=$("#summon_setting ."+t),e=t.attr("class"),a=t.data("select"),n=t.find("[name=c_type]").val(),r=t.find("[name=c_rarity]").val();t.find(".c_summon").empty();for(var c=0;c<d.length;c++){var o=d[c].type,i=d[c].rarity,s=d[c].class,p=d[c].name,l=d[c].id,m=function(){return p.match(/マグナ/)&&e.match(/[1-7]/)||p.match(/グランデ/)&&e.match(/8/)||p.match(/ホワイトラビット/)?"selected":""}();o.match(/type0/)&&i===r&&s.match(a)?$(".type8 .c_summon").append("<option value="+l+">"+p+"</option>"):o.match(n)&&i===r&&s.match(a)&&$("."+e+" .c_summon").append("<option value="+l+" "+m+">"+p+"</option>")}}function n(t){for(var t=$("#summon_setting ."+t),e=t.find(".c_summon").val(),a=0;a<d.length;a++)if(d[a].id.match(e)){var n=t.find(".radio label:eq(0)"),r=t.find(".radio label:eq(1)"),c=t.find(".radio input:eq(0)"),o=t.find(".radio input:eq(1)");n.css("display",""),r.css("display","none"),c.prop("checked",!0),o.prop("checked",!1),d[a].rank4.length>1?r.css("display",""):0===d[a].rank3.length&&c.prop("checked",!1)}}function r(){var t=$(".setting .type8 .title").hasClass("type_icon");if(t)l.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!t){l.find(".type8 .title").html('<span>Lv** ****</span><div class="npc-rank"><div class="ico-npc-rank"></div><div class="txt-npc-rank">*</div></div>').removeClass("type_icon").addClass("type-npc"),l.find(".type8 .content").addClass("breakword"),l.find(".type8 .name").text("");for(var e=["&","<",">",'"',"'"],a=["&amp;","&lt;","&gt;","&quot;","&#39;"],n=$('textarea[name="comment"]').val(),r=0;r<e.length;r++)n=n.replace(new RegExp(e[r],"g"),a[r]);$(".type8 .info").html(n).removeClass("rank0 rank3 rank4")}var c=$(".type9 [name=c_type]").val(),o=parseInt($('input[name="user_id"]').val()),o=function(){return Number.isNaN(o)?"":o}();$(".type9 .info").html("<div>"+o+"</div>"),$(".c_summon").each(function(){for(var t=$(this).val(),e=$(this).parent().next().find("input:radio:checked").val(),a=$(this).parent().parent().parent().attr("class"),n=$(this).parent().parent().siblings(".c_level").val(),n=function(){return n>1?"Lv"+n+" ":""}(),r=$(this).parent().parent().siblings(".c_quality").val(),o=0;o<d.length;o++){var i=d[o].name,s=d[o].class,p=d[o].rarity,m=d[o].id;if(m.match(t)){var h=function(){if(s.match(/^character$/)){if(void 0===e)return"_01.jpg";if(e.match(/^rank3$/))return"_02.jpg";if(e.match(/^rank4$/))return"_03.jpg"}if(s.match(/^job$/)){if(c.match(/^Djeeta$/))return"_1_01.png";if(c.match(/^Gran$/))return"_0_01.png"}return".jpg"}();l.find("."+a+" img").attr("src","image/thumbnail/"+m+h);var u=function(){return void 0===e?"rank0":e}(),i=function(){return p.match(/^skin$/)?i.replace(/\(.+\)/,""):i}();/summon/.test(s)&&(l.find("."+a+" .name").text(n+i),l.find("."+a+" .info").html(d[o][u]).removeClass("rank0 rank3 rank4").addClass(u)),/character/.test(s)&&(l.find(".type8 .title span").text(n+i),l.find(".type8 .txt-npc-rank").text("6")),/summon|character/.test(s)&&r>0&&l.find("."+a+" .quality").text("+"+r)}}})}function c(t){var t=$("#summon_setting ."+t),e=t.find(".c_level"),a=t.find(".c_quality"),n=t.find(".c_summon").val(),r=t.attr("data-select"),c=t.find(".c_rarity").val(),o=t.find("input:radio:checked").val(),i=function(){return void 0==o?"rank0":o}();e.empty(),a.empty();var s=function(){return n.match(/^20300(68|69|70|71|72)000$/)?20:r.match(/^summon$/)&&c.match(/^n$/)&&i.match(/^rank0$/)?10:r.match(/^(summon|character)$/)&&c.match(/^r$/)&&i.match(/^rank0$/)?20:r.match(/^(summon|character)$/)&&c.match(/^sr$/)&&i.match(/^rank0$/)?30:r.match(/^summon$/)&&c.match(/^n$/)&&i.match(/^rank3$/)?40:r.match(/^(summon|character)$/)&&c.match(/^ssr$/)&&i.match(/^rank0$/)?40:r.match(/^(summon|character)$/)&&c.match(/^r$/)&&i.match(/^rank3$/)?50:r.match(/^character$/)&&c.match(/^sr$/)&&i.match(/^rank3$/)?70:r.match(/^summon$/)&&c.match(/^sr$/)&&i.match(/^rank3$/)?75:r.match(/^character$/)&&c.match(/^ssr$/)&&i.match(/^rank3$/)?80:r.match(/^summon$/)&&c.match(/^ssr$/)&&i.match(/^rank3$/)?100:r.match(/^character$/)&&c.match(/^ssr$/)&&i.match(/^rank4$/)?100:r.match(/^summon$/)&&c.match(/^ssr$/)&&i.match(/^rank4$/)?150:0}();if(0===s)return e.append('<option value=""></option>'),void a.append('<option value=""></option>');for(var p=s;p>=1;p--){var l="Lv"+p;e.append('<option value="'+p+'">'+l+"</option>")}for(var p=0;p<=99;p++){var l="+"+p;a.append('<option value="'+p+'">'+l+"</option>")}}function o(){if(u("setting")){var t=["setting","type0","type1","type2","type3","type4","type5","type6","type7","type8","type9"];$.each(t,function(t,e){h(e,"")})}var e=[],a={},n=$('input[name="user_id"]').val(),r=function(){return void 0===n?"":encodeURIComponent(n)}(),c=$('textarea[name="comment"]').val(),o=function(){return void 0===c?"":encodeURIComponent(c)}(),i=$(".setting .type8 .title").hasClass("type_icon");a.user=r,a.text=o,a.summon=i,e.push(a),$(".c_summon").each(function(){var t={},a=$(this),n=a.parent().parent().parent().attr("class"),r=a.parent().parent().siblings(".c_type").val(),c=a.parent().parent().siblings(".c_rarity").val(),o=a.val(),i=a.parent().next().find("input:radio:checked").val(),s=function(){return void 0===i?"rank0":i.match(/rank3/)?"rank3":i.match(/rank4/)?"rank4":void 0}();t.target=n,t.type=r,t.rarity=c,t.id=o,t.rank=s,e.push(t)});var s=new Date(Date.now()+31536e6),p=JSON.stringify(e),l=encodeURIComponent(p);h("st_key",l,s)}function s(){var t=u("st_key"),e=decodeURIComponent(t),o=JSON.parse(e);$.each(o,function(t,e){var r=e.target,o=e.type,i=e.rarity,s=e.id,p=e.rank,l=$("#summon_setting ."+r),m=l.find(".c_type");switch(m.val(o),o){case"type1":m.css("color","#FF0000");break;case"type2":m.css("color","#00FFFF");break;case"type3":m.css("color","#FF9872");break;case"type4":m.css("color","#00FF00");break;case"type5":m.css("color","#FFFF00");break;case"type6":m.css("color","#FF00FF")}l.find(".c_rarity").val(i),void 0!==r&&a(r),l.find(".c_summon").val(s),void 0!==r&&n(r),"rank0"===p?l.find(".radio input:eq(0)").prop("checked",!1):"rank3"===p?l.find(".radio input:eq(0)").prop("checked",!0):"rank4"===p&&l.find(".radio input:eq(1)").prop("checked",!0),void 0!==r&&c(r);var d=e.user,h=e.summon,u=e.text;if(void 0!==d&&$('input[name="user_id"]').val(d),!1===h){var v=$(".setting .type8 .title"),f=v.html(),m=v.nextAll(".c_type"),y=v.nextAll(".c_rarity"),k=v.nextAll(".radio"),_=v.parent().attr("class");y.find("option").prop("selected",!1),y.empty(),v.removeClass("type_icon").html(f.replace(/フリー属性2/g,"推しキャラ")),m.css("color","#FF0000").attr("selected",!1).val("type1"),y.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),v.parent().attr("data-select","character").data("select","character"),k.find(".r_rank3").text("上限解放"),k.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),v.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),a(_)}void 0!==u&&$('textarea[name="comment"]').val(decodeURIComponent(u))}),r()}function p(){var t=Cookies.getJSON("type0");if(!t.sIcon){var e=$(".setting .type8 .title"),o=e.html(),i=e.nextAll(".c_type"),s=e.nextAll(".c_rarity"),p=e.nextAll(".radio"),l=e.parent().attr("class");s.find("option").prop("selected",!1),s.empty(),e.removeClass("type_icon").html(o.replace(/フリー属性2/g,"推しキャラ")),i.css("color","#FF0000").attr("selected",!1).val("type1"),s.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),p.find(".r_rank3").text("上限解放"),p.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),a(l),e.parent().find("textarea").val(decodeURIComponent(t.sChar))}$('input[name="user_id"]').val(decodeURIComponent(t.sUser));for(var m=1;m<10;m++){var d="type"+m,h=Cookies.getJSON(d),u=$("#summon_setting ."+d),v=u.find(".c_type");switch(v.val(h.sType),h.sType){case"type1":v.css("color","#FF0000");break;case"type2":v.css("color","#00FFFF");break;case"type3":v.css("color","#FF9872");break;case"type4":v.css("color","#00FF00");break;case"type5":v.css("color","#FFFF00");break;case"type6":v.css("color","#FF00FF")}u.find(".c_rarity").val(h.sRari);var l=d;a(l),u.find(".c_summon").val(h.sSele),n(l),c(l),"rank0"===h.sRank?u.find(".radio input:eq(0)").prop("checked",!1):"rank3"===h.sRank?u.find(".radio input:eq(0)").prop("checked",!0):"rank4"===h.sRank&&u.find(".radio input:eq(1)").prop("checked",!0)}r()}var l=$("#summon_screeen"),m=[],d=[],h=function(t,e,a){var n=t+"="+e+";path=/;";Number(a)>0&&(n+="expires="+a.toGMTString()),document.cookie=n},u=function(t){var e=t.length+1,a=document.cookie.split("; "),n="";for(i=0,j=a.length;i<j;i++)if(a[i].substr(0,e)===t+"="){n=a[i].substr(e,a[i].length);break}return n};$.getJSON("assets/echo.php",t),$("#change").on("click",function(){r(),o()}),$("div").on("change",".c_summon",function(){var t=$(this).parent().parent().parent().attr("class");n(t),c(t)}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var t=$(this).parent(),e=(t.find(".c_summon"),t.find("[name=c_type]")),r=e.val(),o=t.attr("class");switch(a(o),n(o),c(o),r){case"type1":e.css("color","#FF0000");break;case"type2":e.css("color","#00FFFF");break;case"type3":e.css("color","#FF9872");break;case"type4":e.css("color","#00FF00");break;case"type5":e.css("color","#FFFF00");break;case"type6":e.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var t=$(this),e=t.html(),r=t.nextAll(".c_type"),o=t.nextAll(".c_rarity"),i=t.nextAll(".radio"),s=t.hasClass("type_icon"),p=t.parent().attr("class");if(o.find("option").prop("selected",!1),o.empty(),s){var t=$(".setting .type8 .title");t.removeClass("type_icon").html(e.replace(/フリー属性2/g,"推しキャラ")),r.css("color","#FF0000").attr("selected",!1).val("type1"),o.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),t.parent().attr("data-select","character").data("select","character"),i.find(".r_rank3").text("上限解放"),i.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),t.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),a(p)}else s||(t.addClass("type_icon").html(e.replace(/推しキャラ/g,"フリー属性2")),r.css("color","#FFFF00").attr("selected",!1).val("type5"),o.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="n">N</option>'),t.parent().attr("data-select","summon").data("select","summon"),i.find(".r_rank3").text("3凸"),i.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),t.nextAll("textarea").remove(),a(p));n(p),c(p)}),$(".radio label span").on("click",function(t){t.preventDefault();for(var e=$(this).parent().parent().prev().children().val(),a=0;a<d.length;a++)if(d[a].id.match(e)&&0!==d[a].rank0.length&&0!==d[a].rank3.length){var n=$(this).prev("input");n.prop("checked")?n.prop("checked",!1):n.prop("checked",!0)}c($(this).parent().parent().parent().parent().attr("class"))}),$("#screenshot").on("click",function(){l.append('<p class="add">https://prfac.com/gbf/summon/</p>'),"yes"==$("input[name=resize]:checked").val()&&l.addClass("picture"),html2canvas(l,{onrendered:function(t){var e=t.toDataURL();$("#screen_image").attr("src",e),$("#download_screen").attr("download","image.png").attr("href",e)}}),setTimeout(function(){l.find(".add").remove(),l.removeClass("picture")},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var t=(screen.availWidth-770)/2,e=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+t+",top="+e+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else alert("画像生成してください。")})});