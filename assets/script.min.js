$(function(){function e(e){p=e,l=p,d("ck_cookie",!0),m("ck_cookie")||alert("Cookieが無効になっています。"),m("st_key")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){i()},function(e){t()}):Cookies.get("setting")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){c()},function(e){t()}):t()}function t(){$('#summon_setting div[class^="type"]').each(function(){var e=$(this).attr("class");n(e),a(e),o()})}function n(e){for(var e=$("#summon_setting ."+e),t=e.attr("class"),n=e.data("select"),a=e.find("[name=c_type]").val(),o=e.find("[name=c_rarity]").val(),r=0;r<l.length;r++){var i=l[r].type,c=l[r].rarity,s=l[r].class,p=l[r].name,d=l[r].id,m=function(){return p.match(/マグナ/)&&t.match(/[1-7]/)||p.match(/グランデ/)&&t.match(/8/)||p.match(/ホワイトラビット/)?"selected":""}();i.match(/type0/)&&c===o&&s.match(n)?$(".type8 .c_summon").append("<option value="+d+">"+p+"</option>"):i.match(a)&&c===o&&s.match(n)&&$("."+t+" .c_summon").append("<option value="+d+" "+m+">"+p+"</option>")}}function a(e){for(var e=$("#summon_setting ."+e),t=e.find(".c_summon").val(),n=0;n<l.length;n++)if(l[n].id.match(t)){var a=e.find(".radio label:eq(0)"),o=e.find(".radio label:eq(1)"),r=e.find(".radio input:eq(0)"),i=e.find(".radio input:eq(1)");a.css("display",""),o.css("display","none"),r.prop("checked",!0),i.prop("checked",!1),l[n].rank4.length>1?o.css("display",""):0===l[n].rank3.length&&r.prop("checked",!1)}}function o(){var e=$(".setting .type8 .title").hasClass("type_icon");if(e)s.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!e){s.find(".type8 .title").html('<span>Lv** ****</span><div class="npc-rank"><div class="ico-npc-rank"></div><div class="txt-npc-rank">*</div></div>').removeClass("type_icon").addClass("type-npc"),s.find(".type8 .content").addClass("breakword"),s.find(".type8 .name").text("");for(var t=["&","<",">",'"',"'"],n=["&amp;","&lt;","&gt;","&quot;","&#39;"],a=$('textarea[name="comment"]').val(),o=0;o<t.length;o++)a=a.replace(new RegExp(t[o],"g"),n[o]);$(".type8 .info").html(a).removeClass("rank0 rank3 rank4")}var r=$(".type9 [name=c_type]").val(),i=parseInt($('input[name="user_id"]').val()),i=function(){return Number.isNaN(i)?"":i}();$(".type9 .info").html("<div>"+i+"</div>"),$(".c_summon").each(function(){for(var e=$(this).val(),t=$(this).nextAll(".radio").find("input:radio:checked").val(),n=$(this).parent().attr("class"),a=0;a<l.length;a++){var o=l[a].name,i=l[a].class,c=l[a].id;if(c.match(e)){var p=function(){if(i.match(/^character$/)){if(void 0===t)return"_01.jpg";if(t.match(/^rank3$/))return"_02.jpg";if(t.match(/^rank4$/))return"_03.jpg"}if(i.match(/^job$/)){if(r.match(/^Djeeta$/))return"_1_01.png";if(r.match(/^Gran$/))return"_0_01.png"}return".jpg"}();s.find("."+n+" img").attr("src","image/thumbnail/"+c+p);var d=function(){return void 0===t?"rank0":t}();/summon/.test(i)&&(s.find("."+n+" .name").text("Lv1 "+o),s.find("."+n+" .info").html(l[a][d]).removeClass("rank0 rank3 rank4").addClass(d)),/character/.test(i)&&(s.find(".type8 .title span").text("Lv1 "+o),s.find(".type8 .txt-npc-rank").text("6")),/summon|character/.test(i)&&s.find("."+n+" .quality").text("+99")}}})}function r(){if(m("setting")){var e=["setting","type0","type1","type2","type3","type4","type5","type6","type7","type8","type9"];$.each(e,function(e,t){d(t,"")})}var t=[],n={},a=$('input[name="user_id"]').val(),o=function(){return void 0===a?"":encodeURIComponent(a)}(),r=$('textarea[name="comment"]').val(),i=function(){return void 0===r?"":encodeURIComponent(r)}(),c=$(".setting .type8 .title").hasClass("type_icon");n.user=o,n.text=i,n.summon=c,t.push(n),$(".c_summon").each(function(){var e={},n=$(this),a=n.parent().attr("class"),o=n.siblings(".c_type").val(),r=n.siblings(".c_rarity").val(),i=n.val(),c=n.nextAll(".radio").find("input:radio:checked").val(),s=function(){return void 0===c?"rank0":c.match(/rank3/)?"rank3":c.match(/rank4/)?"rank4":void 0}();e.target=a,e.type=o,e.rarity=r,e.id=i,e.rank=s,t.push(e)});var s=new Date(Date.now()+31536e6),p=JSON.stringify(t),l=encodeURIComponent(p);d("st_key",l,s)}function i(){var e=m("st_key"),t=decodeURIComponent(e),r=JSON.parse(t);$.each(r,function(e,t){var o=t.target,r=t.type,i=t.rarity,c=t.id,s=t.rank,p=$("#summon_setting ."+o),l=p.find(".c_type");switch(l.val(r),r){case"type1":l.css("color","#FF0000");break;case"type2":l.css("color","#00FFFF");break;case"type3":l.css("color","#FF9872");break;case"type4":l.css("color","#00FF00");break;case"type5":l.css("color","#FFFF00");break;case"type6":l.css("color","#FF00FF")}p.find(".c_rarity").val(i),void 0!==o&&n(o),p.find(".c_summon").val(c),void 0!==o&&a(o),"rank0"===s?p.find(".radio input:eq(0)").prop("checked",!1):"rank3"===s?p.find(".radio input:eq(0)").prop("checked",!0):"rank4"===s&&p.find(".radio input:eq(1)").prop("checked",!0);var d=t.user,m=t.summon,u=t.text;if(void 0!==d&&$('input[name="user_id"]').val(d),!1===m){var h=$(".setting .type8 .title"),v=h.html(),l=h.nextAll(".c_type"),f=h.nextAll(".c_rarity"),y=h.nextAll(".radio"),k=h.parent().attr("class");f.find("option").prop("selected",!1),$(".type8 .c_summon").empty(),f.empty(),h.removeClass("type_icon").html(v.replace(/フリー属性2/g,"推しキャラ")),l.css("color","#FF0000").attr("selected",!1).val("type1"),f.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),h.parent().attr("data-select","character").data("select","character"),y.find(".r_rank3").text("上限解放"),y.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),h.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),n(k)}void 0!==u&&$('textarea[name="comment"]').val(decodeURIComponent(u))}),o()}function c(){var e=Cookies.getJSON("type0");if(!e.sIcon){var t=$(".setting .type8 .title"),r=t.html(),i=t.nextAll(".c_type"),c=t.nextAll(".c_rarity"),s=t.nextAll(".radio"),p=t.parent().attr("class");c.find("option").prop("selected",!1),$(".type8 .c_summon").empty(),c.empty(),t.removeClass("type_icon").html(r.replace(/フリー属性2/g,"推しキャラ")),i.css("color","#FF0000").attr("selected",!1).val("type1"),c.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),t.parent().attr("data-select","character").data("select","character"),s.find(".r_rank3").text("上限解放"),s.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),t.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),n(p),t.parent().find("textarea").val(decodeURIComponent(e.sChar))}$('input[name="user_id"]').val(decodeURIComponent(e.sUser));for(var l=1;l<10;l++){var d="type"+l,m=Cookies.getJSON(d),u=$("#summon_setting ."+d),h=u.find(".c_type");switch(h.val(m.sType),m.sType){case"type1":h.css("color","#FF0000");break;case"type2":h.css("color","#00FFFF");break;case"type3":h.css("color","#FF9872");break;case"type4":h.css("color","#00FF00");break;case"type5":h.css("color","#FFFF00");break;case"type6":h.css("color","#FF00FF")}u.find(".c_rarity").val(m.sRari);var p=d;n(p),u.find(".c_summon").val(m.sSele),a(p),"rank0"===m.sRank?u.find(".radio input:eq(0)").prop("checked",!1):"rank3"===m.sRank?u.find(".radio input:eq(0)").prop("checked",!0):"rank4"===m.sRank&&u.find(".radio input:eq(1)").prop("checked",!0)}o()}var s=$("#summon_screeen"),p=[],l=[],d=function(e,t,n){var a=e+"="+t+";path=/;";Number(n)>0&&(a+="expires="+n.toGMTString()),document.cookie=a},m=function(e){var t=e.length+1,n=document.cookie.split("; "),a="";for(u=0,j=n.length;u<j;u++)if(n[u].substr(0,t)===e+"="){a=n[u].substr(t,n[u].length);break}return a};$.getJSON("assets/echo.php",e),$(".change").on("click",function(){o(),r()}),$("div").on("change",".c_summon",function(){a($(this).parent().attr("class"))}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var e=$(this).parent(),t=e.find(".c_summon"),o=e.find("[name=c_type]"),r=o.val(),i=e.attr("class");switch(t.empty(),n(i),a(i),r){case"type1":o.css("color","#FF0000");break;case"type2":o.css("color","#00FFFF");break;case"type3":o.css("color","#FF9872");break;case"type4":o.css("color","#00FF00");break;case"type5":o.css("color","#FFFF00");break;case"type6":o.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var e=$(this),t=e.html(),o=e.nextAll(".c_type"),r=e.nextAll(".c_rarity"),i=e.nextAll(".radio"),c=e.hasClass("type_icon"),s=e.parent().attr("class");if(r.find("option").prop("selected",!1),$(".type8 .c_summon").empty(),r.empty(),c){var e=$(".setting .type8 .title");e.removeClass("type_icon").html(t.replace(/フリー属性2/g,"推しキャラ")),o.css("color","#FF0000").attr("selected",!1).val("type1"),r.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),i.find(".r_rank3").text("上限解放"),i.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),n(s)}else c||(e.addClass("type_icon").html(t.replace(/推しキャラ/g,"フリー属性2")),o.css("color","#FFFF00").attr("selected",!1).val("type5"),r.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="n">N</option>'),e.parent().attr("data-select","summon").data("select","summon"),i.find(".r_rank3").text("3凸"),i.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),e.nextAll("textarea").remove(),n(s));a(s)}),$(".radio label").on("click",function(e){e.preventDefault();for(var t=$(this).parent().prev().children().val(),n=0;n<l.length;n++)if(l[n].id.match(t)&&0!==l[n].rank0.length&&0!==l[n].rank3.length){var a=$(this).prev("input");console.log(a),a.prop("checked")?(console.log("false"),a.prop("checked",!1)):(console.log("true"),a.prop("checked",!0))}}),function(e){for(var t=e;t>=1;t--){var n="Lv"+t;$(".c_level").append('<option value="'+n+'">'+n+"</option>")}}(150);for(var u=0;u<=99;u++){var h="+"+u;$(".c_quality").append('<option value="'+h+'">'+h+"</option>")}$("#screenshot").on("click",function(){s.append('<p class="add">https://prfac.com/gbf/summon/</p>'),"yes"==$("input[name=resize]:checked").val()&&s.addClass("picture"),html2canvas(s,{onrendered:function(e){var t=e.toDataURL();$("#screen_image").attr("src",t),$("#download_screen").attr("download","image.png").attr("href",t)}}),setTimeout(function(){s.find(".add").remove(),s.removeClass("picture")},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var e=(screen.availWidth-770)/2,t=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+e+",top="+t+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else alert("画像生成してください。")})});