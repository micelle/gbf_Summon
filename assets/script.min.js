function setCookie(e,t,a){var n=e+"="+t+";path=/;";Number(a)>0&&(n+="expires="+a.toGMTString()),document.cookie=n}function getCookie(e){var t=e.length+1,a=document.cookie.split("; "),n="";for(i=0,j=a.length;i<j;i++)if(a[i].substr(0,t)===e+"="){n=a[i].substr(t,a[i].length);break}return n}function init(e){echoData=e,setCookie("ck_cookie",!0),getCookie("ck_cookie")||swal("Cookieが無効になっています","設定内容が保存できません。<br>ご注意ください。","info");var t=getCookie("st_key");if(query.length>1){try{var a=decodeURIComponent(query),n=JSON.parse(a)}catch(e){return swal({title:"URLに不備があります",text:"デフォルトの設定で表示します。",type:"error",timer:2500}),void jsCookie_Noload()}swal({title:"URLの設定内容を復元する？",type:"question",html:"URLに設定された召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(e){e.value?n.info?jsBookmark_load(n):jsAry_load(n):jsCookie_Noload()})}else t?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(e){e.value?jsCookie_load():jsCookie_Noload()}):jsCookie_Noload()}function init2(e){foxData=e}function jsCookie_Noload(){$("#summon_setting div[class^=type]").each(function(){var e=$(this).attr("class");list_display(e),radio_display(e),level_select(e),table_display()})}function list_display(e){var e=$("#summon_setting ."+e),t=e.attr("class"),a=e.data("select"),n=e.find("[name=c_type]").val(),o=e.find("[name=c_rarity]").val();e.find(".c_summon").empty(),t.match(/[1-8]/)&&$("."+t+" .c_summon").append('<option value="unselected">【未選択】</option>');for(var i=0;i<echoData.length;i++){var r=echoData[i].type,s=echoData[i].rarity,c=echoData[i].class,l=echoData[i].name,p=echoData[i].id,d=function(){return l.match(/マグナ/)&&t.match(/[1-7]/)||l.match(/グランデ/)&&t.match(/8/)||l.match(/ホワイトラビット/)?"selected":""}();r.match(/type0/)&&s===o&&c.match(a)?$(".type8 .c_summon").append("<option value="+p+">"+l+"</option>"):r.match(n)&&s===o&&c.match(a)&&$("."+t+" .c_summon").append("<option value="+p+" "+d+">"+l+"</option>")}}function radio_display(e){for(var e=$("#summon_setting ."+e),t=e.find(".c_summon").val(),a=0;a<echoData.length;a++)if(echoData[a].id.match(t)){var n=e.find(".radio label:eq(0)"),o=e.find(".radio label:eq(1)"),i=e.find(".radio input:eq(0)"),r=e.find(".radio input:eq(1)");n.css("display",""),o.css("display","none"),i.prop("checked",!0),r.prop("checked",!1),echoData[a].rank4.length>1?o.css("display",""):0===echoData[a].rank3.length&&i.prop("checked",!1)}}function table_display(){var e=$("#summon_screeen"),t=$(".setting .type8 .title").hasClass("type_icon");if(t)e.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!t){e.find(".type8 .title").html('<span>Lv** ****</span><div class="npc-rank"><div class="ico-npc-rank"></div><div class="txt-npc-rank">*</div></div>').removeClass("type_icon").addClass("type-npc"),e.find(".type8 .content").addClass("breakword"),e.find(".type8 .name").text("");for(var a=["&","<",">",'"',"'"],n=["&amp;","&lt;","&gt;","&quot;","&#39;"],o=$("textarea[name=comment]").val(),i=0;i<a.length;i++)o=o.replace(new RegExp(a[i],"g"),n[i]);$(".type8 .info").html(o).removeClass("rank0 rank3 rank4")}var r=$(".type9 [name=c_type]").val(),s=parseInt($("input[name=user_id]").val()),s=function(){return Number.isNaN(s)?"":s}(),s=String(s).replace(/\D/g,"").slice(0,10);$(".type9 .info").html("<div>"+s+"</div>"),$(".c_summon").each(function(){var t=$(this).val(),a=$(this).parent().next().find("input:radio:checked").val(),n=$(this).parent().parent().parent().attr("class"),o=$(this).parent().parent().siblings(".c_level").val(),o=function(){return o>0?"Lv"+o+" ":""}(),i=$(this).parent().parent().siblings(".c_quality").val(),i=function(){return i>1?"+"+i+" ":""}(),s=$(this).parent().parent().parent().find(".c_bonus").val();if("unselected"==t){e.find("."+n+" img").attr("src","image/thumbnail/empty.jpg"),e.find("."+n+" .quality").text("");$(this).parent().parent().siblings().hasClass("type_icon")?(e.find("."+n+" .name").text("召喚石が設定されていません"),e.find("."+n+" .info").html("").removeClass("rank0 rank3 rank4").addClass("rank0")):(e.find("."+n+" .name").text("コメントが設定されていません"),e.find("."+n+" .title span").text("推しキャラが設定されていません"),e.find("."+n+" .npc-rank").addClass("display_none"),e.find("."+n+" .info").html("").removeClass("rank0 rank3 rank4"))}for(var c=0;c<echoData.length;c++){var l=echoData[c].name,p=echoData[c].class,d=echoData[c].rarity,u=echoData[c].id;if(u.match(t)){var v=function(){if(p.match(/^character$/)){if(void 0===a)return"_01.jpg";if(a.match(/^rank3$/))return"_02.jpg";if(a.match(/^rank4$/))return"_03.jpg"}if(p.match(/^job$/)){if(r.match(/^Djeeta$/))return"_1_01.png";if(r.match(/^Gran$/))return"_0_01.png"}if(p.match(/^summon$/)&&u.match(/^20400(20|27|28|34|46|47)000$/)){if(void 0===a)return".jpg";if(a.match(/^rank4$/))return"_02.jpg"}return".jpg"}();e.find("."+n+" img").attr("src","image/thumbnail/"+u+v);var m=function(){return void 0===a?"rank0":a}(),l=function(){return d.match(/^skin$/)?l.replace(/\(.+\)/,""):l}();/summon/.test(p)&&(e.find("."+n+" .name").text(o+l),e.find("."+n+" .info").html(echoData[c][m]).removeClass("rank0 rank3 rank4").addClass(m)),/character/.test(p)&&(e.find(".type8 .title span").text(o+l),void 0===s||0==s?e.find(".type8 .npc-rank").addClass("display_none"):(e.find(".type8 .npc-rank").removeClass("display_none"),e.find(".type8 .txt-npc-rank").text(s))),/summon|character/.test(p)&&e.find("."+n+" .quality").text(i)}}})}function level_select(e){var e=$("#summon_setting ."+e),t=e.find(".c_level"),a=e.find(".c_quality"),n=e.find(".c_bonus"),o=e.find(".c_summon").val(),i=e.attr("data-select"),r=e.find(".c_rarity").val(),s=e.find("input:radio:checked").val(),c=function(){return void 0==s?"rank0":s}(),l=function(){return null==o||o.match(/^unselected$/)||"job"==i?[0]:String(o).match(/^20300(68|69|70|71|72)000$/)?[20]:foxData[i][r][c]}(),p=l[l.length-1],d=function(){return i.match(/^character$/)?300:99}();if(t.empty(),a.empty(),n.empty(),0===p)return t.append('<option value=""></option>'),a.append('<option value=""></option>'),void n.append('<option value=""></option>');for(var u=l.join("|"),v=new RegExp("^("+u+")$"),m="",h="",f=p;f>1;f--)v.test(f)?m+='<option value="'+f+'">Lv'+f+"</option>":h+='<option value="'+f+'">Lv'+f+"</option>";t.append('<optgroup label="レベル">'+m+'<option value="1">Lv1</option></optgroup>'),t.append('<optgroup label="その他">'+h+"</optgroup>");for(var y="",f=1;f<d;f++)y+='<option value="'+f+'">+'+f+"</option>";a.append('<optgroup label="ボーナス"><option value="0">+0</option><option value="'+d+'">+'+d+"</option></optgroup>"),a.append('<optgroup label="その他">'+y+"</optgroup>");for(var _="",f=0;f<=999;f++)_+='<option value="'+f+'">'+f+"</option>";n.append('<optgroup label="リミボ">'+_+"</optgroup>")}function jsCookie_save(){if(getCookie("setting")){var e=["setting","type0","type1","type2","type3","type4","type5","type6","type7","type8","type9"];$.each(e,function(e,t){setCookie(t,"")})}var t=[],a={},n=$("input[name=user_id]").val(),o=function(){return void 0===n?"":encodeURIComponent(n)}(),i=$("textarea[name=comment]").val(),r=function(){return void 0===i?"":encodeURIComponent(i)}(),s=$(".setting .type8 .title").hasClass("type_icon"),c=$(".c_bonus").val();a.user=o,a.text=r,a.summon=s,t.push(a),$(".c_summon").each(function(){var e={},a=$(this),n=a.parent().parent().parent().attr("class"),o=a.parent().parent().siblings(".c_type").val(),i=a.parent().parent().siblings(".c_rarity").val(),r=a.val(),s=a.parent().next().find("input:radio:checked").val(),l=function(){return void 0===s?"rank0":s.match(/rank3/)?"rank3":s.match(/rank4/)?"rank4":void 0}(),p=a.parent().parent().siblings(".c_level").val(),d=a.parent().parent().siblings(".c_quality").val();e.target=n,e.type=o,e.rarity=i,e.id=r,e.rank=l,e.level=p,e.quality=d,"type8"==n&&(e.bonus=c),t.push(e)});var l=new Date(Date.now()+31536e6),p=JSON.stringify(t),d=encodeURIComponent(p);setCookie("st_key",d,l),urlQuery(d)}function jsCookie_load(){var e=getCookie("st_key"),t=decodeURIComponent(e);jsAry_load(JSON.parse(t))}function jsBookmark_load(e){function t(e,t){for(var a=0;a<echoData.length;a++){if(e==echoData[a].id)return echoData[a][t]}}var a=[];for(var n in e){var o=e[n].target;null==o&&!0!==e[n]?a.push(e[n]):/type[1-8]/.test(o)?(e[n].type=t(e[n].id,"type"),a.push(e[n])):/type9/.test(o)&&(e[n].rarity=t(e[n].id,"rarity"),a.push(e[n]))}jsAry_load(a)}function jsAry_load(e){$.each(e,function(e,t){var a=t.target,n=t.type,o=t.rarity,i=t.id,r=t.rank,s=t.level,c=t.quality,l=$("#summon_setting ."+a),p=l.find(".c_type");switch(p.val(n),n){case"type1":p.css("color","#FF0000");break;case"type2":p.css("color","#00FFFF");break;case"type3":p.css("color","#FF9872");break;case"type4":p.css("color","#00FF00");break;case"type5":p.css("color","#FFFF00");break;case"type6":p.css("color","#FF00FF")}l.find(".c_rarity").val(o),void 0!==a&&list_display(a),l.find(".c_summon").val(i),void 0!==a&&radio_display(a),"rank0"===r?l.find(".radio input:eq(0)").prop("checked",!1):"rank3"===r?l.find(".radio input:eq(0)").prop("checked",!0):"rank4"===r&&l.find(".radio input:eq(1)").prop("checked",!0);var d=t.user,u=t.summon,v=t.text,m=t.bonus;if(void 0!==d&&$("input[name=user_id]").val(d),!1===u){var h=$(".setting .type8 .title"),f=h.html(),p=h.nextAll(".c_type"),y=h.nextAll(".c_rarity"),_=h.nextAll(".radio"),k=h.parent().attr("class");y.find("option").prop("selected",!1),y.empty(),h.removeClass("type_icon").html(f.replace(/フリー属性2/g,"推しキャラ")),p.css("color","#FF0000").attr("selected",!1).val("type1"),y.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),h.parent().attr("data-select","character").data("select","character"),_.find(".r_rank3").text("上限解放"),_.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),h.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),list_display(k)}if(void 0!==a&&level_select(a),void 0!==s&&l.find(".c_level").val(s),void 0!==s&&l.find(".c_quality").val(c),void 0!==m&&$(".c_bonus").val(m),void 0!==v){var g="";try{g=decodeURIComponent(v)}catch(e){}$("textarea[name=comment]").val(g)}}),table_display();var t=JSON.stringify(e);urlQuery(encodeURIComponent(t))}function urlQuery(e){var t=function(){return null==e?url:url+"?st_key="+e}();$("input[name=query]").val(t)}function copyTextToClipboard(e){var t=document.createElement("textarea");t.className="clipboard",t.textContent=e;var a=document.getElementsByTagName("body")[0];a.appendChild(t),t.select();var n=document.execCommand("copy");return a.removeChild(t),n}var echoData=[],foxData={},url=location.href.replace(/\?.*/,""),query=location.search.replace(/\?st_key=/g,"");$(function(){var e=$("#summon_screeen");$.getJSON("assets?json=foxtrot",init2),$.getJSON("assets?json=echo",init),$("#change").on("click",function(){table_display(),jsCookie_save()}),$("div").on("change",".c_summon",function(){var e=$(this).parent().parent().parent().attr("class");radio_display(e),level_select(e)}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var e=$(this).parent(),t=(e.find(".c_summon"),e.find("[name=c_type]")),a=t.val(),n=e.attr("class");switch(list_display(n),radio_display(n),level_select(n),a){case"type1":t.css("color","#FF0000");break;case"type2":t.css("color","#00FFFF");break;case"type3":t.css("color","#FF9872");break;case"type4":t.css("color","#00FF00");break;case"type5":t.css("color","#FFFF00");break;case"type6":t.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var e=$(this),t=e.html(),a=e.nextAll(".c_type"),n=e.nextAll(".c_rarity"),o=e.nextAll(".radio"),i=e.hasClass("type_icon"),r=e.parent().attr("class");if(n.find("option").prop("selected",!1),n.empty(),$(".select8").remove(),i){var e=$(".setting .type8 .title");e.removeClass("type_icon").html(t.replace(/フリー属性2/g,"推しキャラ")),a.css("color","#FF0000").attr("selected",!1).val("type1"),n.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),o.find(".r_rank3").text("上限解放"),o.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),list_display(r)}else i||(e.addClass("type_icon").html(t.replace(/推しキャラ/g,"フリー属性2")),a.css("color","#FFFF00").attr("selected",!1).val("type5"),n.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="n">N</option>'),e.parent().attr("data-select","summon").data("select","summon"),o.find(".r_rank3").text("3凸"),o.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),e.nextAll("textarea").remove(),list_display(r));radio_display(r),level_select(r)}),$(".radio label span").on("click",function(e){if(!$(this).parent().parent().attr("class").match(/resize/)){e.preventDefault();for(var t=$(this).parent().parent().prev().children().val(),a=0;a<echoData.length;a++)if(echoData[a].id.match(t)&&0!==echoData[a].rank0.length&&0!==echoData[a].rank3.length){var n=$(this).prev("input");n.prop("checked")?n.prop("checked",!1):n.prop("checked",!0)}level_select($(this).parent().parent().parent().parent().attr("class"))}}),$("#screenshot").on("click",function(){e.append('<p class="add">'+url+"&nbsp;&nbsp;&nbsp;</p>"),"yes"==$("input[name=resize]:checked").val()&&e.addClass("picture"),html2canvas(e,{onrendered:function(e){var t=e.toDataURL();$("#screen_image").attr("src",t)}}),setTimeout(function(){e.find(".add").remove(),e.removeClass("picture")},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var e=(screen.availWidth-770)/2,t=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+e+",top="+t+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else swal({title:"画像生成してください。",type:"error",timer:2500})}),$("input[name=user_id]").bind("keydown keyup keypress mouseup focusout change",function(){var e=$(this).val(),e=String(e).replace(/\D/g,"").slice(0,10);$(this).val(e)}),$(".svg svg").on("click",function(){copyTextToClipboard($(this).prev().val())?swal({title:"コピーに成功しました。",type:"success",timer:2500}):swal({title:"コピーに失敗しました。",type:"error",timer:2500})});var t=0;$(window).keydown(function(e){var a=$("div.w50:eq(1)");a.hasClass("display_none")&&(e.ctrlKey||e.metaKey)&&66===e.keyCode&&(t<2?t+=1:swal({title:"ブックマークレットを表示する？",type:"warning",html:'<span style="font-size: 10pt;">【注意】<br>本サイトのブックマークレットを利用した事による、欠陥およびそれらが原因で発生した損失や損害については一切責任を負いません。</span>',showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(e){e.value&&a.removeClass("display_none")}))})});