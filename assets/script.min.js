$(function(){function t(t){v=t}function e(t){u=t,m("ck_cookie",!0),f("ck_cookie")||alert("Cookieが無効になっています。"),f("st_key")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){p()},function(t){n()}):Cookies.get("setting")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){l()},function(t){n()}):n()}function n(){$('#summon_setting div[class^="type"]').each(function(){var t=$(this).attr("class");a(t),o(t),s(t),r()})}function a(t){var t=$("#summon_setting ."+t),e=t.attr("class"),n=t.data("select"),a=t.find("[name=c_type]").val(),o=t.find("[name=c_rarity]").val();t.find(".c_summon").empty(),e.match(/[1-8]/)&&$("."+e+" .c_summon").append('<option value="unselected">【未選択】</option>');for(var i=0;i<u.length;i++){var r=u[i].type,s=u[i].rarity,c=u[i].class,p=u[i].name,l=u[i].id,d=function(){return p.match(/マグナ/)&&e.match(/[1-7]/)||p.match(/グランデ/)&&e.match(/8/)||p.match(/ホワイトラビット/)?"selected":""}();r.match(/type0/)&&s===o&&c.match(n)?$(".type8 .c_summon").append("<option value="+l+">"+p+"</option>"):r.match(a)&&s===o&&c.match(n)&&$("."+e+" .c_summon").append("<option value="+l+" "+d+">"+p+"</option>")}}function o(t){for(var t=$("#summon_setting ."+t),e=t.find(".c_summon").val(),n=0;n<u.length;n++)if(u[n].id.match(e)){var a=t.find(".radio label:eq(0)"),o=t.find(".radio label:eq(1)"),i=t.find(".radio input:eq(0)"),r=t.find(".radio input:eq(1)");a.css("display",""),o.css("display","none"),i.prop("checked",!0),r.prop("checked",!1),u[n].rank4.length>1?o.css("display",""):0===u[n].rank3.length&&i.prop("checked",!1)}}function r(){var t=$(".setting .type8 .title").hasClass("type_icon");if(t)d.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!t){d.find(".type8 .title").html('<span>Lv** ****</span><div class="npc-rank"><div class="ico-npc-rank"></div><div class="txt-npc-rank">*</div></div>').removeClass("type_icon").addClass("type-npc"),d.find(".type8 .content").addClass("breakword"),d.find(".type8 .name").text("");for(var e=["&","<",">",'"',"'"],n=["&amp;","&lt;","&gt;","&quot;","&#39;"],a=$('textarea[name="comment"]').val(),o=0;o<e.length;o++)a=a.replace(new RegExp(e[o],"g"),n[o]);$(".type8 .info").html(a).removeClass("rank0 rank3 rank4")}var i=$(".type9 [name=c_type]").val(),r=parseInt($('input[name="user_id"]').val()),r=function(){return Number.isNaN(r)?"":r}(),r=String(r).replace(/\D/g,"").slice(0,10);$(".type9 .info").html("<div>"+r+"</div>"),$(".c_summon").each(function(){var t=$(this).val(),e=$(this).parent().next().find("input:radio:checked").val(),n=$(this).parent().parent().parent().attr("class"),a=$(this).parent().parent().siblings(".c_level").val(),a=function(){return a>0?"Lv"+a+" ":""}(),o=$(this).parent().parent().siblings(".c_quality").val(),o=function(){return o>1?"+"+o+" ":""}(),r=$(this).parent().parent().parent().find(".c_bonus").val();if("unselected"==t){d.find("."+n+" img").attr("src","image/thumbnail/empty.jpg"),d.find("."+n+" .quality").text("");$(this).parent().parent().siblings().hasClass("type_icon")?(d.find("."+n+" .name").text("召喚石が設定されていません"),d.find("."+n+" .info").html("").removeClass("rank0 rank3 rank4").addClass("rank0")):(d.find("."+n+" .name").text("コメントが設定されていません"),d.find("."+n+" .title span").text("推しキャラが設定されていません"),d.find("."+n+" .npc-rank").addClass("display_none"),d.find("."+n+" .info").html("").removeClass("rank0 rank3 rank4"))}for(var s=0;s<u.length;s++){var c=u[s].name,p=u[s].class,l=u[s].rarity,v=u[s].id;if(v.match(t)){var m=function(){if(p.match(/^character$/)){if(void 0===e)return"_01.jpg";if(e.match(/^rank3$/))return"_02.jpg";if(e.match(/^rank4$/))return"_03.jpg"}if(p.match(/^job$/)){if(i.match(/^Djeeta$/))return"_1_01.png";if(i.match(/^Gran$/))return"_0_01.png"}if(p.match(/^summon$/)&&v.match(/^20400(20|27|28|34|46|47)000$/)){if(void 0===e)return".jpg";if(e.match(/^rank4$/))return"_02.jpg"}return".jpg"}();d.find("."+n+" img").attr("src","image/thumbnail/"+v+m);var f=function(){return void 0===e?"rank0":e}(),c=function(){return l.match(/^skin$/)?c.replace(/\(.+\)/,""):c}();/summon/.test(p)&&(d.find("."+n+" .name").text(a+c),d.find("."+n+" .info").html(u[s][f]).removeClass("rank0 rank3 rank4").addClass(f)),/character/.test(p)&&(d.find(".type8 .title span").text(a+c),void 0===r||0==r?d.find(".type8 .npc-rank").addClass("display_none"):(d.find(".type8 .npc-rank").removeClass("display_none"),d.find(".type8 .txt-npc-rank").text(r))),/summon|character/.test(p)&&d.find("."+n+" .quality").text(o)}}})}function s(t){var t=$("#summon_setting ."+t),e=t.find(".c_level"),n=t.find(".c_quality"),a=t.find(".c_bonus"),o=t.find(".c_summon").val(),i=t.attr("data-select"),r=t.find(".c_rarity").val(),s=t.find("input:radio:checked").val(),c=function(){return void 0==s?"rank0":s}(),p=function(){return o.match(/^unselected$/)||null==o||"job"==i?[0]:String(o).match(/^20300(68|69|70|71|72)000$/)?[20]:v[i][r][c]}(),l=p[p.length-1],d=function(){return i.match(/^character$/)?300:99}();if(e.empty(),n.empty(),a.empty(),0===l)return e.append('<option value=""></option>'),n.append('<option value=""></option>'),void a.append('<option value=""></option>');for(var u=p.join("|"),m=new RegExp("^("+u+")$"),f="",h="",y=l;y>1;y--)m.test(y)?f+='<option value="'+y+'">Lv'+y+"</option>":h+='<option value="'+y+'">Lv'+y+"</option>";e.append('<optgroup label="レベル">'+f+'<option value="1">Lv1</option></optgroup>'),e.append('<optgroup label="その他">'+h+"</optgroup>");for(var k="",y=1;y<d;y++)k+='<option value="'+y+'">+'+y+"</option>";n.append('<optgroup label="ボーナス"><option value="0">+0</option><option value="'+d+'">+'+d+"</option></optgroup>"),n.append('<optgroup label="その他">'+k+"</optgroup>");for(var g="",y=0;y<=999;y++)g+='<option value="'+y+'">'+y+"</option>";a.append('<optgroup label="リミボ">'+g+"</optgroup>")}function c(){if(f("setting")){var t=["setting","type0","type1","type2","type3","type4","type5","type6","type7","type8","type9"];$.each(t,function(t,e){m(e,"")})}var e=[],n={},a=$('input[name="user_id"]').val(),o=function(){return void 0===a?"":encodeURIComponent(a)}(),i=$('textarea[name="comment"]').val(),r=function(){return void 0===i?"":encodeURIComponent(i)}(),s=$(".setting .type8 .title").hasClass("type_icon"),c=$(".c_bonus").val();n.user=o,n.text=r,n.summon=s,e.push(n),$(".c_summon").each(function(){var t={},n=$(this),a=n.parent().parent().parent().attr("class"),o=n.parent().parent().siblings(".c_type").val(),i=n.parent().parent().siblings(".c_rarity").val(),r=n.val(),s=n.parent().next().find("input:radio:checked").val(),p=function(){return void 0===s?"rank0":s.match(/rank3/)?"rank3":s.match(/rank4/)?"rank4":void 0}(),l=n.parent().parent().siblings(".c_level").val(),d=n.parent().parent().siblings(".c_quality").val();t.target=a,t.type=o,t.rarity=i,t.id=r,t.rank=p,t.level=l,t.quality=d,"type8"==a&&(t.bonus=c),e.push(t)});var p=new Date(Date.now()+31536e6),l=JSON.stringify(e),d=encodeURIComponent(l);m("st_key",d,p)}function p(){var t=f("st_key"),e=decodeURIComponent(t),n=JSON.parse(e);$.each(n,function(t,e){var n=e.target,i=e.type,r=e.rarity,c=e.id,p=e.rank,l=e.level,d=e.quality,u=$("#summon_setting ."+n),v=u.find(".c_type");switch(v.val(i),i){case"type1":v.css("color","#FF0000");break;case"type2":v.css("color","#00FFFF");break;case"type3":v.css("color","#FF9872");break;case"type4":v.css("color","#00FF00");break;case"type5":v.css("color","#FFFF00");break;case"type6":v.css("color","#FF00FF")}u.find(".c_rarity").val(r),void 0!==n&&a(n),u.find(".c_summon").val(c),void 0!==n&&o(n),"rank0"===p?u.find(".radio input:eq(0)").prop("checked",!1):"rank3"===p?u.find(".radio input:eq(0)").prop("checked",!0):"rank4"===p&&u.find(".radio input:eq(1)").prop("checked",!0);var m=e.user,f=e.summon,h=e.text,y=e.bonus;if(void 0!==m&&$('input[name="user_id"]').val(m),!1===f){var k=$(".setting .type8 .title"),g=k.html(),v=k.nextAll(".c_type"),_=k.nextAll(".c_rarity"),x=k.nextAll(".radio"),F=k.parent().attr("class");_.find("option").prop("selected",!1),_.empty(),k.removeClass("type_icon").html(g.replace(/フリー属性2/g,"推しキャラ")),v.css("color","#FF0000").attr("selected",!1).val("type1"),_.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),k.parent().attr("data-select","character").data("select","character"),x.find(".r_rank3").text("上限解放"),x.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),k.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(F)}void 0!==n&&s(n),void 0!==l&&u.find(".c_level").val(l),void 0!==l&&u.find(".c_quality").val(d),void 0!==y&&$(".c_bonus").val(y),void 0!==h&&$('textarea[name="comment"]').val(decodeURIComponent(h))}),r()}function l(){var t=Cookies.getJSON("type0");if(!t.sIcon){var e=$(".setting .type8 .title"),n=e.html(),i=e.nextAll(".c_type"),c=e.nextAll(".c_rarity"),p=e.nextAll(".radio"),l=e.parent().attr("class");c.find("option").prop("selected",!1),c.empty(),e.removeClass("type_icon").html(n.replace(/フリー属性2/g,"推しキャラ")),i.css("color","#FF0000").attr("selected",!1).val("type1"),c.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),p.find(".r_rank3").text("上限解放"),p.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(l),e.parent().find("textarea").val(decodeURIComponent(t.sChar))}$('input[name="user_id"]').val(decodeURIComponent(t.sUser));for(var d=1;d<10;d++){var u="type"+d,v=Cookies.getJSON(u),m=$("#summon_setting ."+u),f=m.find(".c_type");switch(f.val(v.sType),v.sType){case"type1":f.css("color","#FF0000");break;case"type2":f.css("color","#00FFFF");break;case"type3":f.css("color","#FF9872");break;case"type4":f.css("color","#00FF00");break;case"type5":f.css("color","#FFFF00");break;case"type6":f.css("color","#FF00FF")}m.find(".c_rarity").val(v.sRari);var l=u;a(l),m.find(".c_summon").val(v.sSele),o(l),s(l),"rank0"===v.sRank?m.find(".radio input:eq(0)").prop("checked",!1):"rank3"===v.sRank?m.find(".radio input:eq(0)").prop("checked",!0):"rank4"===v.sRank&&m.find(".radio input:eq(1)").prop("checked",!0)}r()}var d=$("#summon_screeen"),u=[],v={},m=function(t,e,n){var a=t+"="+e+";path=/;";Number(n)>0&&(a+="expires="+n.toGMTString()),document.cookie=a},f=function(t){var e=t.length+1,n=document.cookie.split("; "),a="";for(i=0,j=n.length;i<j;i++)if(n[i].substr(0,e)===t+"="){a=n[i].substr(e,n[i].length);break}return a};$.getJSON("assets?json=echo",e),$.getJSON("assets?json=foxtrot",t),$("#change").on("click",function(){r(),c()}),$("div").on("change",".c_summon",function(){var t=$(this).parent().parent().parent().attr("class");o(t),s(t)}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var t=$(this).parent(),e=(t.find(".c_summon"),t.find("[name=c_type]")),n=e.val(),i=t.attr("class");switch(a(i),o(i),s(i),n){case"type1":e.css("color","#FF0000");break;case"type2":e.css("color","#00FFFF");break;case"type3":e.css("color","#FF9872");break;case"type4":e.css("color","#00FF00");break;case"type5":e.css("color","#FFFF00");break;case"type6":e.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var t=$(this),e=t.html(),n=t.nextAll(".c_type"),i=t.nextAll(".c_rarity"),r=t.nextAll(".radio"),c=t.hasClass("type_icon"),p=t.parent().attr("class");if(i.find("option").prop("selected",!1),i.empty(),$(".select8").remove(),c){var t=$(".setting .type8 .title");t.removeClass("type_icon").html(e.replace(/フリー属性2/g,"推しキャラ")),n.css("color","#FF0000").attr("selected",!1).val("type1"),i.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),t.parent().attr("data-select","character").data("select","character"),r.find(".r_rank3").text("上限解放"),r.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),t.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(p)}else c||(t.addClass("type_icon").html(e.replace(/推しキャラ/g,"フリー属性2")),n.css("color","#FFFF00").attr("selected",!1).val("type5"),i.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="n">N</option>'),t.parent().attr("data-select","summon").data("select","summon"),r.find(".r_rank3").text("3凸"),r.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),t.nextAll("textarea").remove(),a(p));o(p),s(p)}),$(".radio label span").on("click",function(t){if(!$(this).parent().parent().attr("class").match(/resize/)){t.preventDefault();for(var e=$(this).parent().parent().prev().children().val(),n=0;n<u.length;n++)if(u[n].id.match(e)&&0!==u[n].rank0.length&&0!==u[n].rank3.length){var a=$(this).prev("input");a.prop("checked")?a.prop("checked",!1):a.prop("checked",!0)}s($(this).parent().parent().parent().parent().attr("class"))}}),$("#screenshot").on("click",function(){d.append('<p class="add">https://prfac.com/gbf/summon/</p>'),"yes"==$("input[name=resize]:checked").val()&&d.addClass("picture"),html2canvas(d,{onrendered:function(t){var e=t.toDataURL();$("#screen_image").attr("src",e),$("#download_screen").attr("download","image.png").attr("href",e)}}),setTimeout(function(){d.find(".add").remove(),d.removeClass("picture")},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var t=(screen.availWidth-770)/2,e=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+t+",top="+e+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else alert("画像生成してください。")}),$("input[name=user_id]").bind("keydown keyup keypress mouseup focusout change",function(){var t=$(this).val(),t=String(t).replace(/\D/g,"").slice(0,10);$(this).val(t)})});