$(function(){function e(e){i=e,p=i,Cookies.get("setting")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){s()},function(e){t()}):t()}function t(){$('#summon_setting div[class^="type"]').each(function(){var e=$(this).attr("class");a(e),n(e),r()})}function a(e){for(var e=$("#summon_setting ."+e),t=e.attr("class"),a=e.data("select"),n=e.find("[name=c_type]").val(),r=e.find("[name=c_rarity]").val(),o=0;o<p.length;o++){var s=p[o].type,c=p[o].rarity,i=p[o].class,l=p[o].name,d=p[o].id,m=function(){return l.match(/マグナ/)&&t.match(/[1-7]/)||l.match(/グランデ/)&&t.match(/8/)||l.match(/ホワイトラビット/)?"selected":""}();s.match(/type0/)&&c===r&&i.match(a)?$(".type8 .c_summon").append("<option value="+d+">"+l+"</option>"):s.match(n)&&c===r&&i.match(a)&&$("."+t+" .c_summon").append("<option value="+d+" "+m+">"+l+"</option>")}}function n(e){for(var e=$("#summon_setting ."+e),t=e.find(".c_summon").val(),a=0;a<p.length;a++)if(p[a].id.match(t)){var n=e.find(".radio label:eq(0)"),r=e.find(".radio label:eq(1)"),o=e.find(".radio input:eq(0)"),s=e.find(".radio input:eq(1)");n.css("display",""),r.css("display","none"),o.prop("checked",!0),s.prop("checked",!1),p[a].rank4.length>1?r.css("display",""):0===p[a].rank3.length&&o.prop("checked",!1)}}function r(){$(".c_summon").each(function(){var e=$(this).val(),t=$(this).nextAll(".radio").find("input:radio:checked").val(),a=$(this).parent().attr("class"),n=$(".type9 [name=c_type]").val(),r=$(".setting .type8 .title").hasClass("type_icon");if(r)c.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!r){c.find(".type8 .title").removeClass("type_icon").html("推しキャラ"),$(".type8 .content").addClass("breakword");for(var o=["&","<",">",'"',"'"],s=["&amp;","&lt;","&gt;","&quot;","&#39;"],i=$('textarea[name="comment"]').val(),l=0;l<o.length;l++)i=i.replace(new RegExp(o[l],"g"),s[l]);$(".type8 .spec").html(i).removeClass("rank0 rank3 rank4")}for(var d=0;d<p.length;d++){var m=p[d].class,h=p[d].rarity,u=p[d].id;if(u.match(e)){var f=function(){return m.match(/^summon$/)||m.match(/^character$/)?"_"+h:""}(),v=function(){if(m.match(/^character$/)){if(void 0===t)return"_01.jpg";if(t.match(/^rank3$/))return"_02.jpg";if(t.match(/^rank4$/))return"_03.jpg"}if(m.match(/^job$/)){if(n.match(/^Djeeta$/))return"_1_01.png";if(n.match(/^Gran$/))return"_0_01.png"}return".jpg"}();c.find("."+a+" img").attr("src","image/"+m+f+"/"+u+v);var y=function(){return void 0===t?"rank0":t}();c.find("."+a+" .spec").html(p[d][y]).removeClass("rank0 rank3 rank4").addClass(y)}}var k=parseInt($('input[name="user_id"]').val());$(".type9 .spec").html("<div>"+k+"</div>")})}function o(){Cookies.set("setting","y"),$(".c_summon").each(function(){var e=$(this),t=e.parent().attr("class"),a=e.siblings(".c_type").val(),n=e.siblings(".c_rarity").val(),r=e.val(),o=e.nextAll(".radio").find("input:radio:checked").val(),o=function(){return void 0===o?"rank0":o.match(/rank3/)?"rank3":o.match(/rank4/)?"rank4":void 0}();Cookies.set(t,{sType:a,sRari:n,sSele:r,sRank:o},{expires:365})});var e=$('input[name="user_id"]').val(),e=function(){return void 0===e?"":encodeURIComponent(e)}(),t=$('textarea[name="comment"]').val(),t=function(){return void 0===t?"":encodeURIComponent(t)}(),a=$(".setting .type8 .title").hasClass("type_icon");Cookies.set("type0",{sIcon:a,sUser:e,sChar:t},{expires:365})}function s(){var e=Cookies.getJSON("type0");if(!e.sIcon){var t=$(".setting .type8 .title"),o=t.html(),s=t.nextAll(".c_type"),c=t.nextAll(".c_rarity"),i=t.nextAll(".radio"),p=t.parent().attr("class");c.find("option").prop("selected",!1),$(".type8 .c_summon").empty(),c.empty(),t.removeClass("type_icon").html(o.replace(/フリー属性2/g,"推しキャラ")),s.css("color","#FF0000").attr("selected",!1).val("type1"),c.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),t.parent().attr("data-select","character").data("select","character"),i.find(".r_rank3").text("上限解放"),i.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),t.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),a(p),t.parent().find("textarea").val(decodeURIComponent(e.sChar))}$('input[name="user_id"]').val(decodeURIComponent(e.sUser));for(var l=1;l<10;l++){var d="type"+l,m=Cookies.getJSON(d),h=$("#summon_setting ."+d),u=h.find(".c_type");switch(u.val(m.sType),m.sType){case"type1":u.css("color","#FF0000");break;case"type2":u.css("color","#00FFFF");break;case"type3":u.css("color","#FF9872");break;case"type4":u.css("color","#00FF00");break;case"type5":u.css("color","#FFFF00");break;case"type6":u.css("color","#FF00FF")}h.find(".c_rarity").val(m.sRari);var p=d;a(p),h.find(".c_summon").val(m.sSele),n(p),"rank0"===m.sRank?h.find(".radio input:eq(0)").prop("checked",!1):"rank3"===m.sRank?h.find(".radio input:eq(0)").prop("checked",!0):"rank4"===m.sRank&&h.find(".radio input:eq(1)").prop("checked",!0)}r()}var c=$("#summon_screeen"),i=[],p=[];$.getJSON("assets/echo.php",e),$(".change").on("click",function(){r(),o()}),$("div").on("change",".c_summon",function(){n($(this).parent().attr("class"))}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var e=$(this).parent(),t=e.find(".c_summon"),r=e.find("[name=c_type]"),o=r.val(),s=e.attr("class");switch(t.empty(),a(s),n(s),o){case"type1":r.css("color","#FF0000");break;case"type2":r.css("color","#00FFFF");break;case"type3":r.css("color","#FF9872");break;case"type4":r.css("color","#00FF00");break;case"type5":r.css("color","#FFFF00");break;case"type6":r.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var e=$(this),t=e.html(),r=e.nextAll(".c_type"),o=e.nextAll(".c_rarity"),s=e.nextAll(".radio"),c=e.hasClass("type_icon"),i=e.parent().attr("class");o.find("option").prop("selected",!1),$(".type8 .c_summon").empty(),o.empty(),c?(e.removeClass("type_icon").html(t.replace(/フリー属性2/g,"推しキャラ")),r.css("color","#FF0000").attr("selected",!1).val("type1"),o.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),s.find(".r_rank3").text("上限解放"),s.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45">'),a(i)):c||(e.addClass("type_icon").html(t.replace(/推しキャラ/g,"フリー属性2")),r.css("color","#FFFF00").attr("selected",!1).val("type5"),o.append('<option value="ssr">SSR</option><option value="sr">SR</option>'),e.parent().attr("data-select","summon").data("select","summon"),s.find(".r_rank3").text("3凸"),s.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),e.nextAll("textarea").remove(),a(i)),n(i)}),$("div").on("click",".radio label",function(e){e.preventDefault();for(var t=$(this).parent().prev().val(),a=0;a<p.length;a++)if(p[a].id.match(t)&&0!==p[a].rank0.length&&0!==p[a].rank3.length){var n=$(this).prev("input");n.prop("checked")?n.prop("checked",!1):n.prop("checked",!0)}}),$("#screenshot").on("click",function(){c.find(".title").removeClass("type_icon"),c.append('<p class="add">https://prfac.com/gbf/summon/</p>'),html2canvas(c,{onrendered:function(e){var t=e.toDataURL();$("#screen_image").attr("src",t),$("#download_screen").attr("download","image.png").attr("href",t)}}),setTimeout(function(){c.find(".content").each(function(){$(this).hasClass("breakword")||$(this).prev().addClass("type_icon")}),c.find(".add").remove(),$("html,body").animate({scrollTop:$(".change").offset().top})},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var e=(screen.availWidth-770)/2,t=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+e+",top="+t+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else alert("画像生成してください。")})});