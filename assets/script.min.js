$(function(){function t(t){d=t,m=d,u("ck_cookie",!0),h("ck_cookie")||alert("Cookieが無効になっています。"),h("st_key")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){s()},function(t){e()}):Cookies.get("setting")?swal({title:"前回の設定内容を復元する？",type:"question",html:"前回、設定した召喚石やIDなどを呼び出せます。<br>しないを選択するとデフォルトの設定が表示されます。",showCancelButton:!0,confirmButtonText:"する",cancelButtonText:"しない"}).then(function(){p()},function(t){e()}):e()}function e(){$('#summon_setting div[class^="type"]').each(function(){var t=$(this).attr("class");a(t),n(t),o(t),r()})}function a(t){var t=$("#summon_setting ."+t),e=t.attr("class"),a=t.data("select"),n=t.find("[name=c_type]").val(),r=t.find("[name=c_rarity]").val();t.find(".c_summon").empty(),e.match(/[1-8]/)&&$("."+e+" .c_summon").append('<option value="unselected">【未選択】</option>');for(var o=0;o<m.length;o++){var i=m[o].type,c=m[o].rarity,s=m[o].class,p=m[o].name,l=m[o].id,d=function(){return p.match(/マグナ/)&&e.match(/[1-7]/)||p.match(/グランデ/)&&e.match(/8/)||p.match(/ホワイトラビット/)?"selected":""}();i.match(/type0/)&&c===r&&s.match(a)?$(".type8 .c_summon").append("<option value="+l+">"+p+"</option>"):i.match(n)&&c===r&&s.match(a)&&$("."+e+" .c_summon").append("<option value="+l+" "+d+">"+p+"</option>")}}function n(t){for(var t=$("#summon_setting ."+t),e=t.find(".c_summon").val(),a=0;a<m.length;a++)if(m[a].id.match(e)){var n=t.find(".radio label:eq(0)"),r=t.find(".radio label:eq(1)"),o=t.find(".radio input:eq(0)"),i=t.find(".radio input:eq(1)");n.css("display",""),r.css("display","none"),o.prop("checked",!0),i.prop("checked",!1),m[a].rank4.length>1?r.css("display",""):0===m[a].rank3.length&&o.prop("checked",!1)}}function r(){var t=$(".setting .type8 .title").hasClass("type_icon");if(t)l.find(".type8 .title").addClass("type_icon").html("フリー属性固定召喚石"),$(".type8 .content").removeClass("breakword");else if(!t){l.find(".type8 .title").html('<span>Lv** ****</span><div class="npc-rank"><div class="ico-npc-rank"></div><div class="txt-npc-rank">*</div></div>').removeClass("type_icon").addClass("type-npc"),l.find(".type8 .content").addClass("breakword"),l.find(".type8 .name").text("");for(var e=["&","<",">",'"',"'"],a=["&amp;","&lt;","&gt;","&quot;","&#39;"],n=$('textarea[name="comment"]').val(),r=0;r<e.length;r++)n=n.replace(new RegExp(e[r],"g"),a[r]);$(".type8 .info").html(n).removeClass("rank0 rank3 rank4")}var o=$(".type9 [name=c_type]").val(),i=parseInt($('input[name="user_id"]').val()),i=function(){return Number.isNaN(i)?"":i}();$(".type9 .info").html("<div>"+i+"</div>"),$(".c_summon").each(function(){var t=$(this).val(),e=$(this).parent().next().find("input:radio:checked").val(),a=$(this).parent().parent().parent().attr("class"),n=$(this).parent().parent().siblings(".c_level").val(),n=function(){return n>0?"Lv"+n+" ":""}(),r=$(this).parent().parent().siblings(".c_quality").val(),r=function(){return r>1?"+"+r+" ":""}(),i=$(this).parent().parent().parent().find(".c_bonus").val();if("unselected"==t){l.find("."+a+" img").attr("src","image/thumbnail/empty.jpg"),l.find("."+a+" .quality").text("");$(this).parent().parent().siblings().hasClass("type_icon")?(l.find("."+a+" .name").text("召喚石が設定されていません"),l.find("."+a+" .info").html("").removeClass("rank0 rank3 rank4").addClass("rank0")):(l.find("."+a+" .name").text("コメントが設定されていません"),l.find("."+a+" .title span").text("推しキャラが設定されていません"),l.find("."+a+" .npc-rank").addClass("display_none"),l.find("."+a+" .info").html("").removeClass("rank0 rank3 rank4"))}for(var c=0;c<m.length;c++){var s=m[c].name,p=m[c].class,d=m[c].rarity,u=m[c].id;if(u.match(t)){var h=function(){if(p.match(/^character$/)){if(void 0===e)return"_01.jpg";if(e.match(/^rank3$/))return"_02.jpg";if(e.match(/^rank4$/))return"_03.jpg"}if(p.match(/^job$/)){if(o.match(/^Djeeta$/))return"_1_01.png";if(o.match(/^Gran$/))return"_0_01.png"}if(p.match(/^summon$/)&&u.match(/^20400(20|27|28|34|46|47)000$/)){if(void 0===e)return".jpg";if(e.match(/^rank4$/))return"_02.jpg"}return".jpg"}();l.find("."+a+" img").attr("src","image/thumbnail/"+u+h);var v=function(){return void 0===e?"rank0":e}(),s=function(){return d.match(/^skin$/)?s.replace(/\(.+\)/,""):s}();/summon/.test(p)&&(l.find("."+a+" .name").text(n+s),l.find("."+a+" .info").html(m[c][v]).removeClass("rank0 rank3 rank4").addClass(v)),/character/.test(p)&&(l.find(".type8 .title span").text(n+s),void 0===i||0==i?l.find(".type8 .npc-rank").addClass("display_none"):(l.find(".type8 .npc-rank").removeClass("display_none"),l.find(".type8 .txt-npc-rank").text(i))),/summon|character/.test(p)&&l.find("."+a+" .quality").text(r)}}})}function o(t){var t=$("#summon_setting ."+t),e=t.find(".c_level"),a=t.find(".c_quality"),n=t.find(".c_bonus"),r=t.find(".c_summon").val(),o=t.attr("data-select"),i=t.find(".c_rarity").val(),c=t.find("input:radio:checked").val(),s=function(){return void 0==c?"rank0":c}(),p=function(){return r.match(/^unselected$/)?0:r.match(/^20300(68|69|70|71|72)000$/)?20:o.match(/^summon$/)&&i.match(/^n$/)&&s.match(/^rank0$/)?10:o.match(/^(summon|character)$/)&&i.match(/^r$/)&&s.match(/^rank0$/)?20:o.match(/^(summon|character)$/)&&i.match(/^sr$/)&&s.match(/^rank0$/)?30:o.match(/^summon$/)&&i.match(/^n$/)&&s.match(/^rank3$/)?40:o.match(/^(summon|character)$/)&&i.match(/^ssr$/)&&s.match(/^rank0$/)?40:o.match(/^(summon|character)$/)&&i.match(/^r$/)&&s.match(/^rank3$/)?50:o.match(/^character$/)&&i.match(/^sr$/)&&s.match(/^rank3$/)?70:o.match(/^summon$/)&&i.match(/^sr$/)&&s.match(/^rank3$/)?75:o.match(/^character$/)&&i.match(/^ssr$/)&&s.match(/^rank3$/)?80:o.match(/^summon$/)&&i.match(/^ssr$/)&&s.match(/^rank3$/)?100:o.match(/^character$/)&&i.match(/^ssr$/)&&s.match(/^rank4$/)?100:o.match(/^summon$/)&&i.match(/^ssr$/)&&s.match(/^rank4$/)?150:0}();if(e.empty(),a.empty(),n.empty(),0===p)return e.append('<option value=""></option>'),a.append('<option value=""></option>'),void n.append('<option value=""></option>');for(var l="",d=p-1;d>1;d--)l+='<option value="'+d+'">Lv'+d+"</option>";e.append('<optgroup label="レベル"><option value="'+p+'">Lv'+p+'</option><option value="1">Lv1</option></optgroup>'),e.append('<optgroup label="その他">'+l+"</optgroup>");for(var m="",d=1;d<99;d++)m+='<option value="'+d+'">+'+d+"</option>";a.append('<optgroup label="ボーナス"><option value="0">+0</option><option value="99">+99</option></optgroup>'),a.append('<optgroup label="その他">'+m+"</optgroup>");for(var u="",d=0;d<=99;d++)u+='<option value="'+d+'">'+d+"</option>";n.append('<optgroup label="リミボ">'+u+"</optgroup>")}function c(){if(h("setting")){var t=["setting","type0","type1","type2","type3","type4","type5","type6","type7","type8","type9"];$.each(t,function(t,e){u(e,"")})}var e=[],a={},n=$('input[name="user_id"]').val(),r=function(){return void 0===n?"":encodeURIComponent(n)}(),o=$('textarea[name="comment"]').val(),i=function(){return void 0===o?"":encodeURIComponent(o)}(),c=$(".setting .type8 .title").hasClass("type_icon"),s=$(".c_bonus").val();a.user=r,a.text=i,a.summon=c,e.push(a),$(".c_summon").each(function(){var t={},a=$(this),n=a.parent().parent().parent().attr("class"),r=a.parent().parent().siblings(".c_type").val(),o=a.parent().parent().siblings(".c_rarity").val(),i=a.val(),c=a.parent().next().find("input:radio:checked").val(),p=function(){return void 0===c?"rank0":c.match(/rank3/)?"rank3":c.match(/rank4/)?"rank4":void 0}(),l=a.parent().parent().siblings(".c_level").val(),d=a.parent().parent().siblings(".c_quality").val();t.target=n,t.type=r,t.rarity=o,t.id=i,t.rank=p,t.level=l,t.quality=d,"type8"==n&&(t.bonus=s),e.push(t)});var p=new Date(Date.now()+31536e6),l=JSON.stringify(e),d=encodeURIComponent(l);u("st_key",d,p)}function s(){var t=h("st_key"),e=decodeURIComponent(t),i=JSON.parse(e);$.each(i,function(t,e){var r=e.target,i=e.type,c=e.rarity,s=e.id,p=e.rank,l=e.level,d=e.quality,m=$("#summon_setting ."+r),u=m.find(".c_type");switch(u.val(i),i){case"type1":u.css("color","#FF0000");break;case"type2":u.css("color","#00FFFF");break;case"type3":u.css("color","#FF9872");break;case"type4":u.css("color","#00FF00");break;case"type5":u.css("color","#FFFF00");break;case"type6":u.css("color","#FF00FF")}m.find(".c_rarity").val(c),void 0!==r&&a(r),m.find(".c_summon").val(s),void 0!==r&&n(r),"rank0"===p?m.find(".radio input:eq(0)").prop("checked",!1):"rank3"===p?m.find(".radio input:eq(0)").prop("checked",!0):"rank4"===p&&m.find(".radio input:eq(1)").prop("checked",!0);var h=e.user,v=e.summon,f=e.text,y=e.bonus;if(void 0!==h&&$('input[name="user_id"]').val(h),!1===v){var k=$(".setting .type8 .title"),_=k.html(),u=k.nextAll(".c_type"),g=k.nextAll(".c_rarity"),x=k.nextAll(".radio"),F=k.parent().attr("class");g.find("option").prop("selected",!1),g.empty(),k.removeClass("type_icon").html(_.replace(/フリー属性2/g,"推しキャラ")),u.css("color","#FF0000").attr("selected",!1).val("type1"),g.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),k.parent().attr("data-select","character").data("select","character"),x.find(".r_rank3").text("上限解放"),x.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),k.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(F)}void 0!==r&&o(r),void 0!==l&&m.find(".c_level").val(l),void 0!==l&&m.find(".c_quality").val(d),void 0!==y&&$(".c_bonus").val(y),void 0!==f&&$('textarea[name="comment"]').val(decodeURIComponent(f))}),r()}function p(){var t=Cookies.getJSON("type0");if(!t.sIcon){var e=$(".setting .type8 .title"),i=e.html(),c=e.nextAll(".c_type"),s=e.nextAll(".c_rarity"),p=e.nextAll(".radio"),l=e.parent().attr("class");s.find("option").prop("selected",!1),s.empty(),e.removeClass("type_icon").html(i.replace(/フリー属性2/g,"推しキャラ")),c.css("color","#FF0000").attr("selected",!1).val("type1"),s.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),e.parent().attr("data-select","character").data("select","character"),p.find(".r_rank3").text("上限解放"),p.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),e.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(l),e.parent().find("textarea").val(decodeURIComponent(t.sChar))}$('input[name="user_id"]').val(decodeURIComponent(t.sUser));for(var d=1;d<10;d++){var m="type"+d,u=Cookies.getJSON(m),h=$("#summon_setting ."+m),v=h.find(".c_type");switch(v.val(u.sType),u.sType){case"type1":v.css("color","#FF0000");break;case"type2":v.css("color","#00FFFF");break;case"type3":v.css("color","#FF9872");break;case"type4":v.css("color","#00FF00");break;case"type5":v.css("color","#FFFF00");break;case"type6":v.css("color","#FF00FF")}h.find(".c_rarity").val(u.sRari);var l=m;a(l),h.find(".c_summon").val(u.sSele),n(l),o(l),"rank0"===u.sRank?h.find(".radio input:eq(0)").prop("checked",!1):"rank3"===u.sRank?h.find(".radio input:eq(0)").prop("checked",!0):"rank4"===u.sRank&&h.find(".radio input:eq(1)").prop("checked",!0)}r()}var l=$("#summon_screeen"),d=[],m=[],u=function(t,e,a){var n=t+"="+e+";path=/;";Number(a)>0&&(n+="expires="+a.toGMTString()),document.cookie=n},h=function(t){var e=t.length+1,a=document.cookie.split("; "),n="";for(i=0,j=a.length;i<j;i++)if(a[i].substr(0,e)===t+"="){n=a[i].substr(e,a[i].length);break}return n};$.getJSON("assets/echo.php",t),$("#change").on("click",function(){r(),c()}),$("div").on("change",".c_summon",function(){var t=$(this).parent().parent().parent().attr("class");n(t),o(t)}),$("div").on("change","div [name=c_type], div [name=c_rarity]",function(){var t=$(this).parent(),e=(t.find(".c_summon"),t.find("[name=c_type]")),r=e.val(),i=t.attr("class");switch(a(i),n(i),o(i),r){case"type1":e.css("color","#FF0000");break;case"type2":e.css("color","#00FFFF");break;case"type3":e.css("color","#FF9872");break;case"type4":e.css("color","#00FF00");break;case"type5":e.css("color","#FFFF00");break;case"type6":e.css("color","#FF00FF")}}),$(".setting .type8 .title").on("click",function(){var t=$(this),e=t.html(),r=t.nextAll(".c_type"),i=t.nextAll(".c_rarity"),c=t.nextAll(".radio"),s=t.hasClass("type_icon"),p=t.parent().attr("class");if(i.find("option").prop("selected",!1),i.empty(),$(".select8").remove(),s){var t=$(".setting .type8 .title");t.removeClass("type_icon").html(e.replace(/フリー属性2/g,"推しキャラ")),r.css("color","#FF0000").attr("selected",!1).val("type1"),i.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="skin">スキン他</option>'),t.parent().attr("data-select","character").data("select","character"),c.find(".r_rank3").text("上限解放"),c.find(".r_rank4").text("最終上限解放").css({"line-height":"16px",height:"16px","font-size":"12px"}),t.parent().append('<div class="box select select8"><div><select class="c_bonus" name="c_bonus"></select></div><div><textarea type="text" name="comment" placeholder="45文字まで入力可能です" maxlength="45"></textarea></div></div>'),a(p)}else s||(t.addClass("type_icon").html(e.replace(/推しキャラ/g,"フリー属性2")),r.css("color","#FFFF00").attr("selected",!1).val("type5"),i.append('<option value="ssr">SSR</option><option value="sr">SR</option><option value="r">R</option><option value="n">N</option>'),t.parent().attr("data-select","summon").data("select","summon"),c.find(".r_rank3").text("3凸"),c.find(".r_rank4").text("4凸").css({"line-height":"",height:"","font-size":""}),t.nextAll("textarea").remove(),a(p));n(p),o(p)}),$(".radio label span").on("click",function(t){t.preventDefault();for(var e=$(this).parent().parent().prev().children().val(),a=0;a<m.length;a++)if(m[a].id.match(e)&&0!==m[a].rank0.length&&0!==m[a].rank3.length){var n=$(this).prev("input");n.prop("checked")?n.prop("checked",!1):n.prop("checked",!0)}o($(this).parent().parent().parent().parent().attr("class"))}),$("#screenshot").on("click",function(){l.append('<p class="add">https://prfac.com/gbf/summon/</p>'),"yes"==$("input[name=resize]:checked").val()&&l.addClass("picture");var t=l.get(0);html2canvas(t).then(function(t){var e=t.toDataURL();$("#screen_image").attr("src",e)}),setTimeout(function(){l.find(".add").remove(),l.removeClass("picture")},100)}),$("#tweet_open").on("click",function(){if($("#screen_image").attr("src")){var t=(screen.availWidth-770)/2,e=(screen.availHeight-600)/2;window.open("twitter/index.php","window","width= 770,height=600,left="+t+",top="+e+", scrollbars = yes, location = no, toolbar = no, menubar = no, status = no")}else alert("画像生成してください。")})});