$(function(){function e(){var e=$("textarea").attr("maxlength"),t=$("textarea").val().length;$("#140tweet").text(e-t)}var t=function(){var e=window.opener.$("#screen_image").attr("src");return e||sessionStorage.getItem("imageData")}(),t=t.replace("data:image/png;base64,","");$("#tweet").on("click",function(){if($("#140tweet").text()>=0){if($(this).blur(),$("#overlay")[0])return!1;$("body").append('<div id="overlay"><div class="loader"></div></div>'),$("#overlay").fadeIn("slow");var e=$("#oauth_token").val(),a=$("#oauth_token_secret").val(),n=$(".radio").find("input:radio:checked").val(),o=$('textarea[name="tweTxt"]').val(),r=function(){return"yes"==n?o+" #フレ石編成的ななにか":"no"==n?o:void 0}();$.ajax({url:"tweet.php",type:"post",dataType:"json",data:{oauth_token:e,oauth_token_secret:a,imgUrl:t,tweTxt:r}}).done(function(e){$("#overlay").fadeOut("slow",function(){$("#overlay").remove(),$("#tweet").after("<p>ツイートに成功しました。</p>")})}).fail(function(){$("#overlay").fadeOut("slow",function(){$("#overlay").remove(),$("#tweet").after("<p>ツイートに失敗しました。<br>このウィンドウを閉じ、改めてお試し下さい。</p>")})})}else alert("文字数がオーバーしてます。")}),$(".radio").on("click",function(t){var a=$(this).find("input:radio:checked").val(),n=function(){return"yes"==a?"128":"no"==a?"140":void 0}();console.log(n),$("textarea").attr("maxlength",n),e()}),$("textarea").bind("keydown keyup keypress change",function(){e()})});